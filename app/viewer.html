<!DOCTYPE html>
<html>
<head>
  <style type="text/css">
    html, body {
      background-color: #222;
      margin: 0;
    }
  </style>
</head>
<body>
<canvas id="c" width="512" height="480"></canvas>
<script src="../lib/level.js"></script>
<script src="../lib/nescolors.js"></script>
<script>
  const colorMap = {
    ' ': NESCOLORS[3],
    '$': NESCOLORS[9],
    '.': NESCOLORS[4]
  };

  class GRAPHICS {
    constructor() {
      const canvas = document.getElementById('c');
      this.ctx = canvas.getContext('2d');
      this.ctx.scale(2, 2);
    }
    go() {
      this.ctx.fillStyle = NESCOLORS[12];
      this.ctx.fillRect(0,0,256,240);
    }
    draw(level) {
      const levelSize = level.tiles.length;
      for (let row = 0; row < levelSize; row++) {
        for (let col = 0; col < levelSize; col++) {
          const tile = level.tiles[row][col];
          this.ctx.fillStyle = colorMap[tile];
          this.ctx.fillRect(64 + (col*16),64 + (row*16),16,16); 
        }
      }
    }
  };

  window.pushUp = () => {
    this.l.rotateClockwise();
    this.l.rotateClockwise();
    this.l.stepDown();
    this.l.rotateClockwise();
    this.l.rotateClockwise();
    this.g.draw(l);
  }

  window.pushLeft = () => {
    this.l.rotateClockwise();
    this.l.rotateClockwise();
    this.l.rotateClockwise();
    this.l.stepDown();
    this.l.rotateClockwise();
    this.g.draw(l);
  }

  window.pushRight = () => {
    this.l.rotateClockwise();
    this.l.stepDown();
    this.l.rotateClockwise();
    this.l.rotateClockwise();
    this.l.rotateClockwise();
    this.g.draw(l);
  }

  window.pushDown = () => {
    this.l.stepDown();
    this.g.draw(l);
  }

  window.onload = () => {
    const s = [
      '....',
      '....',
      '.$. ',
      '... '
    ];

    this.l = new LEVEL(s.join('\n'));
    this.g = new GRAPHICS();
    this.g.go();
    this.g.draw(l);
  };
</script>
</body>
</html>
